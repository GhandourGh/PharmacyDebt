{% extends "base.html" %}

{% block title %}Edit Customer - Pharmacy Thabet{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title">
        <i data-lucide="edit" class="icon-info"></i>
        Edit: {{ customer.name }}
    </h1>
</div>

<div class="card card-info" style="max-width: 500px;">
    <form method="POST" enctype="multipart/form-data">
        <div class="form-group">
            <label class="form-label">Profile Image (optional)</label>
            <div class="image-upload-container">
                <div class="image-preview" id="imagePreview">
                    {% if customer.profile_image %}
                    <img src="{{ url_for('static', filename='uploads/' + customer.profile_image) }}" alt="{{ customer.name }}" style="width: 100%; height: 100%; object-fit: cover;" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div style="display: none; width: 100%; height: 100%; align-items: center; justify-content: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                        <i data-lucide="user" style="width: 48px; height: 48px; color: white;"></i>
                    </div>
                    {% else %}
                    <i data-lucide="user" style="width: 48px; height: 48px; color: #94a3b8;"></i>
                    {% endif %}
                </div>
                <input type="file" name="profile_image" id="profileImage" class="image-input" accept="image/*" onchange="previewImage(event)">
                <label for="profileImage" class="btn btn-secondary btn-sm">
                    <i data-lucide="upload" style="width: 14px; height: 14px;"></i>
                    {% if customer.profile_image %}Change Image{% else %}Choose Image{% endif %}
                </label>
                {% if customer.profile_image %}
                <label class="btn btn-danger btn-sm" style="margin-left: 0.5rem;">
                    <input type="checkbox" name="remove_image" value="1" style="margin-right: 0.5rem;">
                    Remove Image
                </label>
                {% endif %}
                <p style="font-size: 0.8rem; color: #64748b; margin-top: 0.5rem;">Recommended: Square image, max 5MB</p>
            </div>
        </div>

        <div class="form-group">
            <label class="form-label">Name *</label>
            <input type="text" name="name" class="form-control" required value="{{ customer.name }}">
        </div>

        <div class="form-group">
            <label class="form-label">Phone (optional)</label>
            <input type="text" name="phone" class="form-control" value="{{ customer.phone or '' }}">
        </div>

        <div class="form-group">
            <label class="form-label">Notes (optional)</label>
            <textarea name="notes" class="form-control" rows="2">{{ customer.notes or '' }}</textarea>
        </div>

        <div class="btn-group">
            <button type="submit" class="btn btn-primary">
                <i data-lucide="save"></i>
                Save
            </button>
            <a href="{{ url_for('customer_detail', customer_id=customer.id) }}" class="btn btn-secondary">Cancel</a>
        </div>
    </form>

    <hr style="margin: 2rem 0; border: none; border-top: 1px solid #e2e8f0;">

    <div style="background: #fef2f2; border: 1px solid #fca5a5; border-radius: 8px; padding: 1rem;">
        <h3 style="color: #dc2626; margin-bottom: 0.5rem;">Delete Customer</h3>
        <p style="color: #991b1b; margin-bottom: 1rem; font-size: 0.9rem;">
            This will hide the customer from the list. History is kept.
        </p>
        <form method="POST" action="{{ url_for('delete_customer', customer_id=customer.id) }}" onsubmit="return confirm('Delete this customer?')">
            <button type="submit" class="btn btn-danger">
                <i data-lucide="trash-2"></i>
                Delete Customer
            </button>
        </form>
    </div>
</div>

<script>
function previewImage(event) {
    const file = event.target.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = function(e) {
            const preview = document.getElementById('imagePreview');
            preview.innerHTML = `<img src="${e.target.result}" alt="Preview" style="width: 100%; height: 100%; object-fit: cover;">`;
        };
        reader.readAsDataURL(file);
    }
}
</script>
{% endblock %}
